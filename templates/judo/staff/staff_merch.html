{% extends "judo/base.html" %}
{% load crispy_forms_tags %}

{% block title_block %}
  GUJC - Staff Merchandise
{% endblock %}

{% block navbar %}
    {% include 'judo/staff/staff_navbar.html' %}
{% endblock %}

{% block body_block %}
<div class="container mt-5">
  <div class="row">
    <!-- Add your staff merchandise content here -->
    <div class="col-lg-8 offset-lg-2">
      <!-- Display existing merchandise items -->
      <div class="row">
        {% for item in merch_items %}
        <div class="col-lg-4 col-md-6 mb-3">
          <div class="card">
            <!-- Apply a fixed aspect ratio to the card container -->
            <div class="card-container">
              <div class="image-container">
                <img src="{{ item.picture.url }}" class="card-img-top" alt="{{ item.name }}">
              </div>
            </div>
            <div class="card-body">
              <h5 class="card-title">{{ item.name }}</h5>
              <p class="card-text">Price: ${{ item.price }}</p>
              <!-- Add edit and delete buttons here -->
              <button class="btn btn-primary" data-toggle="modal" data-target="#editModal{{ item.id }}">Edit</button>
              <br /><button class="btn btn-danger" data-toggle="modal" data-target="#deleteModal{{ item.id }}">Delete</button>
            </div>
          </div>
        </div>
        {% endfor %}
      </div><br /> <br /> <br />
      <h1 class="text-center mb-4">Manage Merchandise</h1>
      
      <!-- Add your merchandise management forms and content here -->
      <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        {{ form|crispy}}
        <button type="submit" class="btn btn-primary">Add Merchandise</button>
      </form>
      
      <!-- Edit Item Modal -->
      {% for item in merch_items %}
      <div class="modal fade" id="editModal{{ item.id }}" tabindex="-1" role="dialog" aria-labelledby="editModalLabel{{ item.id }}" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="editModalLabel{{ item.id }}">Edit Item</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <!-- Include the form tag here with the form fields -->
              <form method="post" enctype="multipart/form-data" action="{% url 'judo:edit_item' item.id %}">
                {% csrf_token %}
                <div class="form-group">
                  <label for="edit_name">Name:</label>
                  <input type="text" class="form-control" id="edit_name" name="name" value="{{ item.name }}">
                </div>
                <div class="form-group">
                  <label for="edit_price">Price:</label>
                  <input type="text" class="form-control" id="edit_price" name="price" value="{{ item.price }}">
                </div>
                <div class="form-group">
                  <label for="edit_picture">Picture:</label>
                  <input type="file" class="form-control-file" id="edit_picture" name="picture">
                </div>
                <!-- You should see the form fields here -->
                <!-- Ensure that form fields are correctly defined in EditItemForm -->

                <!-- Add a submit button to save changes -->
                <button type="submit" class="btn btn-primary">Save Changes</button>
              </form>
            </div>
          </div>
        </div>
      </div>
      {% endfor %}




      <!-- Delete Confirmation Modal -->
      {% for item in merch_items %}
      <div class="modal fade" id="deleteModal{{ item.id }}" tabindex="-1" role="dialog" aria-labelledby="deleteModalLabel{{ item.id }}" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="deleteModalLabel{{ item.id }}">Confirm Deletion</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              Are you sure you want to delete this item?
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
              <a href="{% url 'judo:delete_item' item.id %}" class="btn btn-danger">Delete</a>
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
</div>
{% endblock %}
